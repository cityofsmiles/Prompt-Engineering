<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Math Prompt Engineering - Fixed Image Logic</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4.5.0/dist/reveal.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4.5.0/dist/theme/black.css">
    <style>
        :root { --highlight: #42afe3; }
        body { background-color: #000; }
        .reveal h1 { font-size: 3.5em !important; color: var(--highlight); text-transform: uppercase; }
        .reveal h2 { font-size: 2.8em !important; font-weight: 700; }
        .highlight { color: var(--highlight); }
        .slide-image { max-height: 70vh !important; border: 2px solid #444; border-radius: 8px; }
        #overlay { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; justify-content: center; align-items: center; }
        #start-btn { padding: 20px 40px; font-size: 24px; background: var(--highlight); color: #fff; border: none; border-radius: 50px; cursor: pointer; }
    </style>
</head>
<body>

    <div id="overlay"><button id="start-btn" onclick="startPresentation()">START PRESENTATION</button></div>

    <div class="reveal">
        <div class="slides" id="dynamic-slides"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/reveal.js@4.5.0/dist/reveal.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/reveal.js@4.5.0/plugin/math/math.js"></script>

    <script>
        // 1. YOUR URL HERE
        const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRNkl2LsAPhuRetdCsejtmCGftxe1AuzVxjpxbICCdLk5VLuuOMXV_Uz44L0c5Fh5eiZixdi8cMU1fC/pub?output=csv';

        async function startPresentation() {
            document.getElementById('overlay').style.display = 'none';
            if (document.documentElement.requestFullscreen) document.documentElement.requestFullscreen();
            await loadSlides();
        }

        async function loadSlides() {
            const response = await fetch(sheetUrl);
            const csvData = await response.text();
            const rows = csvData.split(/\r?\n/).slice(1);
            const container = document.getElementById('dynamic-slides');

            rows.forEach(row => {
                // IMPROVED PARSING: Handles commas inside URLs correctly
                const cols = row.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g);
                if (!cols || cols.length < 2) return;

                let type = cols[0].replace(/"/g, '').trim();
                let content = cols[1].replace(/"/g, '').trim();
                let imgUrl = cols[2] ? cols[2].replace(/"/g, '').trim() : '';

                const section = document.createElement('section');
                let formattedContent = content.replace(/\*\*(.*?)\*\*/g, '<span class="highlight">$1</span>');

                if (type.toLowerCase() === "image") {
                    section.innerHTML = `
                        <div style="display: flex; flex-direction: column; align-items: center;">
                            <img src="${imgUrl}" class="slide-image">
                            <h3 style="margin-top:20px;">${formattedContent}</h3>
                        </div>`;
                } else if (type.toLowerCase() === "math") {
                    section.innerHTML = `<h2>\\[ ${content} \\]</h2>`;
                } else if (type.toLowerCase() === "title") {
                    section.innerHTML = `<h1>${formattedContent}</h1>`;
                } else {
                    section.innerHTML = `<h2>${formattedContent}</h2>`;
                }
                container.appendChild(section);
            });

            Reveal.initialize({ controls: false, progress: true, transition: 'none', plugins: [ RevealMath.MathJax2 ] });
        }
    </script>
</body>
</html>
